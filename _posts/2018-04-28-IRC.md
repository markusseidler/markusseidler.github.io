---
title: "Image Recognition of Fruits with standard ML techniques"
date: 2018-05-05
tags: [machine learning, data science, image recognition]
header:
    image: "images/IRC/fruits_header.jpg"
excerpt: "Recognizing fruits with classic ML techniques"
---


## Why I am doing this?

Mainly, just for fun. I want to train a machine learning algorithm that
recognizes single fruits in a picture. I like fruits and sometimes I
encounter exotic fruits in Singapore and I have no glue what they are.
Would it not be great to have a machine learning algorithm telling you
which fruit you see?

## How am I doing this?

Good question. First, I will conduct some exploratory data analysis to
visualize an image array. I am planning to convert colored RGB images to
grey-scale for easier processing and will flatten it to a 1d array.
After that, I am thinking of using Decision Tree Classifier, Random Forest,
and Support Vector Machine algorithms. On purpose, I will not use any
neural network in this case such as Convoluational Neural Network and
TensorFlow. I want to see how far I can go by using standard classifiers.

## Should we start?

First, let's look at the underlying dataset. I use the Fruits 360 dataset
found on Kaggle.com. The dataset consists of 38,409 images of 60 fruits
from different angles. Image size is 100x100 pixels and the dataset is
divided in 28,736 images for training purpose and 9,673 images for validation.

Dataset was provided by Horea Muresan, Mihai Oltean, Fruit recognition
from images using deep learning, Technical Report, Babes-Bolyai University.
Thank you!

For example,

Bananas...

<img src="{{ site.url }}{{ site.baseurl }}/images/IRC/bananas_raw.PNG"
alt="Banana Dataset">

That was is easy. But what is this?

<img src="{{ site.url }}{{ site.baseurl }}/images/IRC/salak_raw.PNG"
alt="Salak Dataset">

You don't know meh? Salak or Snake Fruit. 蛇皮果. Try it!

## Image Arrays

Every image is a three dimensional array. While the first two dimensions
identify the location of the pixel, the third dimension indicates the
color with a value beteen 0 and 255 for Red, Green, and Blue (RGB).

The intesity of each of these three color channels can be displayed by
splitting it in three images. Each of them displays only one color channel,
Red, Green, or Blue.

This is the shape of an image with a banana. The Example array displays
the pixels in the row 50, 51, and 52 and in the column 50, 51, and 52.
Each of the pixels consist of three color channels.

<img src="{{ site.url }}{{ site.baseurl }}/images/IRC/example_array.PNG"
alt="Example Array">

I use object-orienated programming and create a class called "ImageArray".
Within this class I write a method that takes out one of the three color
channels and puts it in to a new image.

```python

import numpy as np
import cv2

class ImageArray:
    def __init__(self, image):
        self.image = image
        self.array = np.array(self.image, dtype=np.uint8)
        self.blue, self.green, self.red = cv2.split(self.image)

    def split_color(self):

        zeros = np.zeros ([100,100],dtype=np.uint8)
        red_pic = cv2.merge([zeros, zeros, self.red])
        green_pic = cv2.merge([zeros, self.green, zeros])
        blue_pic = cv2.merge([self.blue, zeros, zeros])
        horizontal_stack = np.hstack((self.image, red_pic,
        green_pic, blue_pic))

```

Then I initiate a class with one particular image. For instance, a picture of
an apple.

```python
img = cv2.imread("../dataset/fruits-360/Training/
Apple Red 2/118_100.jpg")

apple = ImageArray(img)
```

The first image shows the original picture, the others show the same picture
by displaying only one color channel. If the color is dark, then the relevant
color channel value is closer to 0.

<img src="{{ site.url }}{{ site.baseurl }}/images/IRC/color_channels_apple.jpg"
alt="Apple Color Split">

Here is a Strawberry.

```python
img = cv2.imread("../dataset/fruits-360/Training/
Strawberry/r_252_100.jpg")

strawberry = ImageArray(img)
strawberry.split_color()
```

The strawberry is the brightest in the red channel but looks dark in
green and blue.

<img src="{{ site.url }}{{ site.baseurl }}/images/IRC/color_channels_berry.jpg"
alt="Strawberry Color Split">

For easier processing, I decided not to work with colors but to change
the images to gray scale. I add another method to my class ImageArray.

```python
    def gray(self):
        self.image_gray = cv2.cvtColor(self.image, cv2.COLOR_BGR2GRAY)
        cv2.imwrite("gray_scale.jpg", self.image_gray)
```

Let's use an example of a Mandarine.

```python
img = cv2.imread("../dataset/fruits-360/Training/Mandarine/r_135_100.jpg")

mandarine = ImageArray(img)
mandarine.gray()
```

The class method displays the image in gray-scale.

<img src="{{ site.url }}{{ site.baseurl }}/images/IRC/gray_scale.jpg"
alt="Mandarine Gray">

I want to visualize the color distribution and choose to flatten this two
dimensional array consisting of x, y values for each pixel into a one
dimensional array. I want to see a single vector with a series of gray
color values. I write a new method to my class ImageArray.

```python
    def gray_flat(self):
        self.image_gray_flat = self.gray().flatten()

mandarine.gray_flat()
print ("\n\tOriginal shape of the image:\n\t", mandarine.image.shape)
print ("\n\tShape of the image after converting it to gray-scale:\n\t",
mandarine.image_gray.shape)
print ("\n\tShape of the image after flattening:\n\t", mandarine.image_gray_flat.shape)
```

We transformed the original 3D array to 2D and finally to 1D array with
10,000 color inputs in gray.

<img src="{{ site.url }}{{ site.baseurl }}/images/IRC/flat.png"
alt="Flattening">

Now we can display the color distribution in a histogram. I use the Seaborn
libary for a better visualization.




# H1 Heading

## H2 Heading

### H3 Heading

Here's some basic text.


and here's some *italics*

Here's some **bold** text.

And here is a [link] (https://github.io)

Here is a bulleted list:

* First item
+ Second item
- Third item

Here is a numbered list:

1. First
2. Second
3. Third

Python code block:


```python
    import numpy as np

    def test_function (x, y):
    z = np.sum(x,y)
    return z
```



Here is some inline code "x+y"

Hier ist ein Bild

<img src="{{ site.url }}{{ site.baseurl }}/images/IRC/test.JPG" alt="banana">




